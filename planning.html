<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>หน้าการวางแผนการเงิน - BudgetBuddy</title>
    <link rel="stylesheet" href="style.css">
    <style>
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 10px 20px;
            border-radius: 5px;
            color: white;
            z-index: 1000;
            opacity: 0.9;
            transition: opacity 0.3s ease;
        }
        .toast.success {
            background-color: #2ecc71;
        }
        .toast.error {
            background-color: #e74c3c;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>BudgetBuddy</h1>
            <p class="tagline">เพื่อนคู่คิดเรื่องเงินของคุณ</p>
            <nav>
                <ul>
                    <li><a href="index.html">หน้าหลัก</a></li>
                    <li><a href="saving.html">ออมเงิน</a></li>
                    <li><a href="planning.html" class="active">วางแผนการเงิน</a></li>
                    <li><a href="knowledge.html">ความรู้ด้านการเงิน</a></li>
                </ul>
            </nav>
        </header>

        <main>
            <div class="section">
                <h2>หน้าการวางแผนการเงิน</h2>
                <p>ที่นี่คุณสามารถบันทึกรายรับรายจ่าย และวิเคราะห์การซื้อสินค้าได้</p>
                <a href="index.html" class="back-button">← กลับไปหน้าหลัก</a>
            </div>

            <div class="form-section">
                <h2>บันทึกรายรับ</h2>
                <div class="input-group">
                    <label for="incomeAmount">จำนวนเงิน (บาท):</label>
                    <input type="number" id="incomeAmount" placeholder="1000" min="0">
                </div>
                <div class="input-group">
                    <label for="incomeSource">แหล่งที่มา:</label>
                    <input type="text" id="incomeSource" placeholder="เงินเดือน, ค่าขนม, รายได้เสริม">
                </div>
                <div class="input-group">
                    <label for="incomeDate">วันที่:</label>
                    <input type="date" id="incomeDate">
                </div>
                <button id="addIncomeBtn">เพิ่มรายรับ</button>
            </div>

            <div class="form-section">
                <h2>รายการรายรับ</h2>
                <div id="incomeList" class="list-container">
                    <div class="list-item income-empty">
                        <p>ยังไม่มีรายการรายรับ</p>
                    </div>
                </div>
            </div>

            <div class="form-section">
                <h2>บันทึกรายจ่าย</h2>
                <div class="input-group">
                    <label for="expenseItem">รายการ:</label>
                    <input type="text" id="expenseItem" placeholder="อาหาร, ขนส่ง, ค่าเช่า">
                </div>
                <div class="input-group">
                    <label for="expenseAmount">จำนวนเงิน (บาท):</label>
                    <input type="number" id="expenseAmount" placeholder="500" min="0">
                </div>
                <div class="input-group">
                    <label for="expenseCategory">หมวดหมู่:</label>
                    <select id="expenseCategory">
                        <option value="อาหาร">อาหาร</option>
                        <option value="ขนส่ง">ขนส่ง</option>
                        <option value="ที่พัก">ที่พัก</option>
                        <option value="ความบันเทิง">ความบันเทิง</option>
                        <option value="การศึกษา">การศึกษา</option>
                        <option value="สุขภาพ">สุขภาพ</option>
                        <option value="อื่นๆ">อื่นๆ</option>
                    </select>
                </div>
                <div class="input-group">
                    <label for="expenseDate">วันที่:</label>
                    <input type="date" id="expenseDate">
                </div>
                <button id="addExpenseBtn">เพิ่มรายจ่าย</button>
            </div>

            <div class="form-section">
                <h2>รายการรายจ่าย</h2>
                <div id="expenseList" class="list-container">
                    <div class="list-item expense-empty">
                        <p>ยังไม่มีรายการรายจ่าย</p>
                    </div>
                </div>
            </div>

            <div class="form-section">
                <h2>วิเคราะห์การซื้อสินค้า</h2>
                <div class="input-group">
                    <label for="productName">ชื่อสินค้า:</label>
                    <input type="text" id="productName" placeholder="โทรศัพท์, รองเท้า">
                </div>
                <div class="input-group">
                    <label for="productPrice">ราคา (บาท):</label>
                    <input type="number" id="productPrice" placeholder="5000" min="0">
                </div>
                <div class="input-group">
                    <label for="purchaseFrequency">ซื้อบ่อยแค่ไหน (ครั้ง/เดือน):</label>
                    <input type="number" id="purchaseFrequency" placeholder="1" min="0">
                </div>
                <div class="input-group">
                    <label for="isNecessary">จำเป็นหรือไม่:</label>
                    <select id="isNecessary">
                        <option value="true">จำเป็น</option>
                        <option value="false">ไม่จำเป็น</option>
                    </select>
                </div>
                <div class="input-group">
                    <label for="budget">งบประมาณที่มี (บาท):</label>
                    <input type="number" id="budget" placeholder="10000" min="0">
                </div>
                <div class="input-group">
                    <label for="timesCanBuy">ซื้อได้กี่ครั้ง (ถ้าซื้อ):</label>
                    <input type="number" id="timesCanBuy" readonly>
                </div>
                <div class="input-group">
                    <label for="feeling">รู้สึกหนักใจ/กังวลในการซื้อหรือไม่:</label>
                    <select id="feeling">
                        <option value="no">ไม่</option>
                        <option value="yes">ใช่</option>
                    </select>
                </div>
                <button id="analyzeBtn">วิเคราะห์</button>
                <div id="analysisResult" class="analysis-result" style="display: none;"></div>
            </div>

            <div class="summary-section">
                <h2>สรุปรายรับรายจ่าย</h2>
                <div class="summary-item">
                    <span>รายรับรวม:</span>
                    <span id="totalIncome">0 บาท</span>
                </div>
                <div class="summary-item">
                    <span>รายจ่ายรวม:</span>
                    <span id="totalExpenses">0 บาท</span>
                </div>
                <div class="summary-item">
                    <span>คงเหลือ:</span>
                    <span id="remainingBalance">0 บาท</span>
                </div>
            </div>
        </main>

        <div class="back-to-top" id="backToTop">↑</div>

        <footer>
            <div class="footer-content">
                <p>&copy; 2025 BudgetBuddy - แอพพลิเคชั่นสอนการเงินสำหรับทุกคน</p>
                <nav class="footer-nav">
                    <a href="about.html">เกี่ยวกับเรา</a>
                    <a href="contact.html">ติดต่อเรา</a>
                </nav>
            </div>
        </footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // ตั้งค่าวันที่ปัจจุบัน
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('incomeDate').value = today;
            document.getElementById('expenseDate').value = today;

            // โหลดข้อมูลจาก localStorage
            let incomes = JSON.parse(localStorage.getItem('budgetBuddyIncomes') || '[]');
            let expenses = JSON.parse(localStorage.getItem('budgetBuddyExpenses') || '[]');

            // Event Listeners
            document.getElementById('addIncomeBtn').addEventListener('click', addIncome);
            document.getElementById('addExpenseBtn').addEventListener('click', addExpense);
            document.getElementById('analyzeBtn').addEventListener('click', analyzePurchase);
            document.getElementById('backToTop').addEventListener('click', () => window.scrollTo({ top: 0, behavior: 'smooth' }));

            // การเลื่อนหน้าเพื่อแสดงปุ่มกลับขึ้นด้านบน
            window.addEventListener('scroll', () => {
                const backToTop = document.getElementById('backToTop');
                backToTop.classList.toggle('visible', window.pageYOffset > 300);
            });

            // ฟังก์ชันแสดง Toast
            function showToast(message, type = 'success') {
                const toast = document.createElement('div');
                toast.className = `toast ${type}`;
                toast.textContent = message;
                document.body.appendChild(toast);
                setTimeout(() => toast.remove(), 3000);
            }

            // บันทึกรายรับ
            function addIncome() {
                const amount = parseFloat(document.getElementById('incomeAmount').value);
                const source = document.getElementById('incomeSource').value.trim();
                const date = document.getElementById('incomeDate').value;

                if (!isNaN(amount) && amount > 0 && source && date) {
                    incomes.push({ id: Date.now(), amount, source, date });
                    localStorage.setItem('budgetBuddyIncomes', JSON.stringify(incomes));
                    renderIncomeList();
                    updateSummary();
                    showToast('เพิ่มรายรับสำเร็จ!');
                    document.getElementById('incomeAmount').value = '';
                    document.getElementById('incomeSource').value = '';
                    document.getElementById('incomeDate').value = today;
                } else {
                    showToast('กรุณากรอกข้อมูลให้ครบถ้วน', 'error');
                }
            }

            // บันทึกรายจ่าย
            function addExpense() {
                const item = document.getElementById('expenseItem').value.trim();
                const amount = parseFloat(document.getElementById('expenseAmount').value);
                const category = document.getElementById('expenseCategory').value;
                const date = document.getElementById('expenseDate').value;

                if (item && !isNaN(amount) && amount > 0 && category && date) {
                    expenses.push({ id: Date.now(), item, amount, category, date });
                    localStorage.setItem('budgetBuddyExpenses', JSON.stringify(expenses));
                    renderExpenseList();
                    updateSummary();
                    showToast('เพิ่มรายจ่ายสำเร็จ!');
                    document.getElementById('expenseItem').value = '';
                    document.getElementById('expenseAmount').value = '';
                    document.getElementById('expenseDate').value = today;
                } else {
                    showToast('กรุณากรอกข้อมูลให้ครบถ้วน', 'error');
                }
            }

            // แสดงรายการรายรับ
            function renderIncomeList() {
                const incomeList = document.getElementById('incomeList');
                incomeList.innerHTML = incomes.length ? '' : '<div class="list-item income-empty"><p>ยังไม่มีรายการรายรับ</p></div>';

                incomes.forEach(income => {
                    const item = document.createElement('div');
                    item.className = 'list-item';
                    item.innerHTML = `
                        <div class="list-item-details">
                            <h3>${income.source}</h3>
                            <p>จำนวน: ${income.amount.toLocaleString()} บาท</p>
                            <p>วันที่: ${new Date(income.date).toLocaleDateString('th-TH')}</p>
                        </div>
                        <div class="list-item-actions">
                            <button class="btn-secondary" onclick="deleteIncome(${income.id})">ลบ</button>
                        </div>
                    `;
                    incomeList.appendChild(item);
                });
            }

            // แสดงรายการรายจ่าย
            function renderExpenseList() {
                const expenseList = document.getElementById('expenseList');
                expenseList.innerHTML = expenses.length ? '' : '<div class="list-item expense-empty"><p>ยังไม่มีรายการรายจ่าย</p></div>';

                expenses.forEach(expense => {
                    const item = document.createElement('div');
                    item.className = 'list-item';
                    item.innerHTML = `
                        <div class="list-item-details">
                            <h3>${expense.item}</h3>
                            <p>จำนวน: ${expense.amount.toLocaleString()} บาท</p>
                            <p>หมวดหมู่: ${expense.category}</p>
                            <p>วันที่: ${new Date(expense.date).toLocaleDateString('th-TH')}</p>
                        </div>
                        <div class="list-item-actions">
                            <button class="btn-secondary" onclick="deleteExpense(${expense.id})">ลบ</button>
                        </div>
                    `;
                    expenseList.appendChild(item);
                });
            }

            // ลบรายรับ
            window.deleteIncome = function(id) {
                if (confirm('แน่ใจหรือไม่ว่าจะลบรายการนี้?')) {
                    incomes = incomes.filter(income => income.id !== id);
                    localStorage.setItem('budgetBuddyIncomes', JSON.stringify(incomes));
                    renderIncomeList();
                    updateSummary();
                    showToast('ลบรายรับสำเร็จ!');
                }
            };

            // ลบรายจ่าย
            window.deleteExpense = function(id) {
                if (confirm('แน่ใจหรือไม่ว่าจะลบรายการนี้?')) {
                    expenses = expenses.filter(expense => expense.id !== id);
                    localStorage.setItem('budgetBuddyExpenses', JSON.stringify(expenses));
                    renderExpenseList();
                    updateSummary();
                    showToast('ลบรายจ่ายสำเร็จ!');
                }
            };

            // อัพเดทสรุป
            function updateSummary() {
                const totalIncome = incomes.reduce((sum, inc) => sum + inc.amount, 0);
                const totalExpenses = expenses.reduce((sum, exp) => sum + exp.amount, 0);
                document.getElementById('totalIncome').textContent = `${totalIncome.toLocaleString()} บาท`;
                document.getElementById('totalExpenses').textContent = `${totalExpenses.toLocaleString()} บาท`;
                document.getElementById('remainingBalance').textContent = `${(totalIncome - totalExpenses).toLocaleString()} บาท`;
            }

            // วิเคราะห์การซื้อสินค้า
            function analyzePurchase() {
                const productName = document.getElementById('productName').value.trim();
                const price = parseFloat(document.getElementById('productPrice').value);
                const frequency = parseFloat(document.getElementById('purchaseFrequency').value);
                const isNecessary = document.getElementById('isNecessary').value === 'true';
                const budget = parseFloat(document.getElementById('budget').value);
                const feeling = document.getElementById('feeling').value === 'yes';

                if (!productName || isNaN(price) || price <= 0 || isNaN(frequency) || frequency < 0 || isNaN(budget) || budget <= 0) {
                    showToast('กรุณากรอกข้อมูลให้ครบถ้วนและถูกต้อง', 'error');
                    return;
                }

                // คำนวณจำนวนครั้งที่ซื้อได้
                const timesCanBuy = Math.floor(budget / price);
                document.getElementById('timesCanBuy').value = timesCanBuy;

                // วิเคราะห์
                let analysisMessage = `<strong>ผลการวิเคราะห์การซื้อ ${productName}</strong><br>`;
                analysisMessage += `ราคา: ${price.toLocaleString()} บาท<br>`;
                analysisMessage += `ซื้อได้: ${timesCanBuy} ครั้ง จากงบ ${budget.toLocaleString()} บาท<br>`;
                analysisMessage += `ซื้อ ${frequency} ครั้ง/เดือน ใช้เงิน ${frequency * price * 12} บาท/ปี<br>`;

                let resultClass = 'success';
                let recommendation = '';

                if (!isNecessary && feeling) {
                    resultClass = 'warning';
                    recommendation = 'สินค้านี้ไม่จำเป็นและคุณรู้สึกกังวล ควรพิจารณาลดการซื้อหรือหาทางเลือกที่ถูกกว่า';
                } else if (!isNecessary) {
                    resultClass = 'warning';
                    recommendation = 'สินค้านี้ไม่จำเป็น ควรจัดลำดับความสำคัญของการใช้จ่ายใหม่';
                } else if (feeling) {
                    resultClass = 'warning';
                    recommendation = 'ถึงแม้สินค้านี้จำเป็น แต่คุณรู้สึกกังวล ลองมองหาตัวเลือกที่ถูกลงหรือวางแผนงบเพิ่ม';
                } else if (timesCanBuy < frequency) {
                    resultClass = 'danger';
                    recommendation = 'งบประมาณไม่เพียงพอสำหรับการซื้อตามความถี่นี้ ควรลดความถี่หรือเพิ่มงบ';
                } else {
                    recommendation = 'การซื้อนี้อยู่ในงบประมาณและจำเป็น สามารถดำเนินการได้อย่างปลอดภัย';
                }

                analysisMessage += `<br><strong>คำแนะนำ:</strong> ${recommendation}`;

                // แสดงผลลัพธ์
                const analysisResult = document.getElementById('analysisResult');
                analysisResult.innerHTML = analysisMessage;
                analysisResult.className = `analysis-result ${resultClass}`;
                analysisResult.style.display = 'block';

                showToast('วิเคราะห์การซื้อสำเร็จ!');
            }

            // โหลดข้อมูลเริ่มต้น
            renderIncomeList();
            renderExpenseList();
            updateSummary();
        });
    </script>
</body>
</html>